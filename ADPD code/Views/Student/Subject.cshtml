@model List<ADPD_code.ViewModels.StudentSubjectViewModel>
@{ 
    Layout = null;

    // --- T√≠nh to√°n d·ªØ li·ªáu th·ªëng k√™ t·ª´ Model ---
    var totalCourses = Model.Count;
    var totalCredits = Model.Sum(s => s.Credits);
    
    var coursesWithScores = Model.Where(s => s.Score.HasValue).ToList();
    var avgScore = coursesWithScores.Any() ? Math.Round(coursesWithScores.Average(s => s.Score.Value), 2) : 0.0;

    // --- L·∫•y danh s√°ch h·ªçc k·ª≥ v√† nƒÉm h·ªçc duy nh·∫•t ƒë·ªÉ l·ªçc ---
    var semesters = Model.Select(s => s.Semester).Distinct().OrderByDescending(s => s).ToList();
    var academicYears = Model.Select(s => s.AcademicYear).Distinct().OrderByDescending(s => s).ToList();
    
    // --- L·∫•y h·ªçc k·ª≥ v√† nƒÉm h·ªçc g·∫ßn nh·∫•t ---
    var latestAcademicYear = academicYears.FirstOrDefault() ?? "";
    var latestSemester = Model.Where(m => m.AcademicYear == latestAcademicYear)
                              .Select(m => m.Semester)
                              .Distinct()
                              .OrderByDescending(s => s)
                              .FirstOrDefault() ?? "";
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√¥n h·ªçc - StudentMS</title>
    <link href="~/css/subject.css" rel="stylesheet" />
</head>
<body>

    <div class="page-header">
        <div class="page-title">üìö M√¥n h·ªçc c·ªßa t√¥i</div>
        <div class="semester-info">
            H·ªçc k·ª≥: @latestSemester | NƒÉm h·ªçc: @latestAcademicYear
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
        <div class="summary-card">
            <div class="summary-number" id="totalCourses">@totalCourses</div>
            <div class="summary-label">T·ªïng m√¥n h·ªçc</div>
        </div>
        <div class="summary-card">
            <div class="summary-number" id="totalCredits">@totalCredits</div>
            <div class="summary-label">T·ªïng t√≠n ch·ªâ</div>
        </div>
        <div class="summary-card">
            <div class="summary-number" id="avgScore">@avgScore</div>
            <div class="summary-label">ƒêi·ªÉm TB h·ªçc k·ª≥</div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <form id="filterForm">
            <div class="filter-grid">
                <div class="filter-item">
                    <label class="filter-label">T√¨m ki·∫øm m√¥n h·ªçc</label>
                    <input type="text" id="searchInput" class="filter-input"
                           placeholder="Nh·∫≠p t√™n m√¥n h·ªçc ho·∫∑c m√£ m√¥n...">
                </div>
                <div class="filter-item">
                    <label class="filter-label">H·ªçc k·ª≥</label>
                    <select id="semesterFilter" class="filter-select">
                        <option value="">T·∫•t c·∫£</option>
                        @foreach (var semester in semesters)
                        {
                            <option value="@semester">@semester</option>
                        }
                    </select>
                </div>
                <div class="filter-item">
                    <label class="filter-label">NƒÉm h·ªçc</label>
                    <select id="yearFilter" class="filter-select">
                        <option value="">T·∫•t c·∫£</option>
                        @foreach (var year in academicYears)
                        {
                            <option value="@year">@year</option>
                        }
                    </select>
                </div>
                <div class="filter-item">
                    <button type="button" class="btn-filter" onclick="filterCourses()">üîç T√¨m ki·∫øm</button>
                </div>
            </div>
        </form>
    </div>

    <!-- Course Table -->
    <div class="course-table-container">
        <table class="course-table">
            <thead>
                <tr>
                    <th style="width: 30%;">M√¥n h·ªçc</th>
                    <th style="width: 20%;">Gi·∫£ng vi√™n</th>
                    <th style="width: 10%; text-align: center;">T√≠n ch·ªâ</th>
                    <th style="width: 15%; text-align: center;">ƒêi·ªÉm s·ªë</th>
                    <th style="width: 25%; text-align: right;">Thao t√°c</th>
                </tr>
            </thead>
            <tbody id="courseTableBody">
                @foreach (var subject in Model)
                {
                    // Logic ƒë·ªÉ x√°c ƒë·ªãnh class cho ƒëi·ªÉm s·ªë
                    string scoreClass = "score-none";
                    string scoreDisplay = "Ch∆∞a c√≥";
                    if (subject.Score.HasValue)
                    {
                        scoreDisplay = subject.Score.Value.ToString("0.0");
                        if (subject.Score >= 8.5) scoreClass = "score-excellent";
                        else if (subject.Score >= 7.0) scoreClass = "score-good";
                        else if (subject.Score >= 5.5) scoreClass = "score-average";
                        else scoreClass = "score-fail";
                    }

                    <tr data-semester="@subject.Semester" data-year="@subject.AcademicYear" data-name="@subject.CourseName.ToLower()" data-code="@subject.CourseCode.ToLower()">
                        <td>
                            <div class="course-name">@subject.CourseName</div>
                            <div class="course-code">M√£ m√¥n: @subject.CourseCode</div>
                        </td>
                        <td>
                            <div class="lecturer-name">@subject.LecturerName</div>
                        </td>
                        <td style="text-align: center;">
                            <span class="credits-badge">@subject.Credits TC</span>
                        </td>
                        <td style="text-align: center;">
                            <span class="score-display @scoreClass">@scoreDisplay</span>
                        </td>
                        <td style="text-align: right;">
                             <button class="btn-action btn-assignment" onclick="loadContent('Student/Assignments')">üìù B√†i t·∫≠p</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <script src="~/js/Subject.js" asp-append-version="true"></script>
</body>
</html>