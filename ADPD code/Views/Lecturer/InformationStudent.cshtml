@{
    var isPartial = ViewData["IsPartial"] as bool? ?? false;
    Layout = isPartial ? null : "~/Views/Shared/_Layout.cshtml";
}
     <link rel="stylesheet" href="~/css/Information.css" />
    <body>
}
    <div class="container">
        <div class="header">
            <h1>📚 Quản lý Sinh viên</h1>
            <p>Danh sách toàn bộ sinh viên đang được quản lý</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="totalStudents">0</h3>
                <p>Tổng số sinh viên</p>
            </div>
            <div class="stat-card">
                <h3 id="activeStudents">0</h3>
                <p>Đang học</p>
            </div>
            <div class="stat-card">
                <h3 id="avgAttendance">0%</h3>
                <p>Tỷ lệ tham dự TB</p>
            </div>
            <div class="stat-card">
                <h3 id="classCount">0</h3>
                <p>Số lớp</p>
            </div>
        </div>

        <div class="toolbar">
            <div class="search-container">
                <span class="search-icon">🔍</span>
                <input type="text" id="searchInput" placeholder="Tìm kiếm theo tên, MSSV, email...">
            </div>

            <select class="filter-select" id="classFilter">
                <option value="">Tất cả lớp</option>
                <option value="CNTT01-K65">CNTT01-K65</option>
                <option value="CNTT02-K65">CNTT02-K65</option>
                <option value="CNTT03-K65">CNTT03-K65</option>
            </select>

            <select class="filter-select" id="statusFilter">
                <option value="">Tất cả trạng thái</option>
                <option value="active">Đang học</option>
                <option value="inactive">Nghỉ học</option>
            </select>

            <button class="btn btn-excel" onclick="exportToExcel()">
                📊 Xuất Excel
            </button>
        </div>

        <div class="table-container">
            <table id="studentTable">
                <thead>
                    <tr>
                        <th onclick="sortTable(0)">STT</th>
                        <th onclick="sortTable(1)">Avatar</th>
                        <th onclick="sortTable(2)">MSSV ↕</th>
                        <th onclick="sortTable(3)">Họ và tên ↕</th>
                        <th onclick="sortTable(4)">Lớp ↕</th>
                        <th onclick="sortTable(5)">Email</th>
                        <th onclick="sortTable(6)">SĐT</th>
                        <th onclick="sortTable(7)">Điểm TB</th>
                        <th onclick="sortTable(8)">Tỷ lệ tham dự ↕</th>
                        <th>Trạng thái</th>
                    </tr>
                </thead>
                <tbody id="studentTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal hiển thị chi tiết sinh viên -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Thông tin chi tiết sinh viên</h2>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="student-detail">
                    <div class="student-photo" id="modalAvatar">SV</div>
                    <div class="student-info">
                        <div class="info-group">
                            <label>Mã số sinh viên</label>
                            <p id="modalMSSV">-</p>
                        </div>
                        <div class="info-group">
                            <label>Họ và tên</label>
                            <p id="modalName">-</p>
                        </div>
                        <div class="info-group">
                            <label>Lớp</label>
                            <p id="modalClass">-</p>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                    <div class="info-group">
                        <label>Ngày sinh</label>
                        <p id="modalDOB">-</p>
                    </div>
                    <div class="info-group">
                        <label>Giới tính</label>
                        <p id="modalGender">-</p>
                    </div>
                    <div class="info-group">
                        <label>Email</label>
                        <p id="modalEmail">-</p>
                    </div>
                    <div class="info-group">
                        <label>Số điện thoại</label>
                        <p id="modalPhone">-</p>
                    </div>
                    <div class="info-group">
                        <label>Địa chỉ</label>
                        <p id="modalAddress">-</p>
                    </div>
                    <div class="info-group">
                        <label>Trạng thái</label>
                        <p id="modalStatus">-</p>
                    </div>
                </div>

                <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">📊 Thống kê học tập</h3>
                <div class="attendance-stats">
                    <div class="mini-stat">
                        <h4 id="modalGPA">0</h4>
                        <p>Điểm trung bình</p>
                    </div>
                    <div class="mini-stat">
                        <h4 id="modalAttendance">0%</h4>
                        <p>Tỷ lệ tham dự</p>
                    </div>
                    <div class="mini-stat">
                        <h4 id="modalAbsent">0</h4>
                        <p>Số buổi vắng</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dữ liệu mẫu sinh viên
        const students = [
            { id: 1, mssv: '2021600001', name: 'Nguyễn Văn An', class: 'CNTT01-K65', email: 'annv@student.edu.vn', phone: '0912345671', dob: '15/03/2003', gender: 'Nam', address: 'Hà Nội', gpa: 3.45, attendance: 92, absent: 3, status: 'active' },
            { id: 2, mssv: '2021600002', name: 'Trần Thị Bình', class: 'CNTT01-K65', email: 'binhtt@student.edu.vn', phone: '0912345672', dob: '22/05/2003', gender: 'Nữ', address: 'Hải Phòng', gpa: 3.78, attendance: 95, absent: 2, status: 'active' },
            { id: 3, mssv: '2021600003', name: 'Lê Văn Cường', class: 'CNTT02-K65', email: 'cuonglv@student.edu.vn', phone: '0912345673', dob: '10/07/2003', gender: 'Nam', address: 'Hà Nội', gpa: 3.21, attendance: 88, absent: 5, status: 'active' },
            { id: 4, mssv: '2021600004', name: 'Phạm Thị Dung', class: 'CNTT02-K65', email: 'dungpt@student.edu.vn', phone: '0912345674', dob: '18/09/2003', gender: 'Nữ', address: 'Nam Định', gpa: 3.56, attendance: 90, absent: 4, status: 'active' },
            { id: 5, mssv: '2021600005', name: 'Hoàng Văn Em', class: 'CNTT01-K65', email: 'emhv@student.edu.vn', phone: '0912345675', dob: '05/11/2003', gender: 'Nam', address: 'Hà Nội', gpa: 3.12, attendance: 85, absent: 6, status: 'active' },
            { id: 6, mssv: '2021600006', name: 'Vũ Thị Phương', class: 'CNTT03-K65', email: 'phuongvt@student.edu.vn', phone: '0912345676', dob: '30/01/2003', gender: 'Nữ', address: 'Thái Bình', gpa: 3.67, attendance: 93, absent: 3, status: 'active' },
            { id: 7, mssv: '2021600007', name: 'Đặng Văn Giang', class: 'CNTT03-K65', email: 'giangdv@student.edu.vn', phone: '0912345677', dob: '12/04/2003', gender: 'Nam', address: 'Hà Nội', gpa: 3.34, attendance: 87, absent: 5, status: 'active' },
            { id: 8, mssv: '2021600008', name: 'Bùi Thị Hoa', class: 'CNTT02-K65', email: 'hoabt@student.edu.vn', phone: '0912345678', dob: '25/06/2003', gender: 'Nữ', address: 'Hưng Yên', gpa: 3.89, attendance: 97, absent: 1, status: 'active' },
            { id: 9, mssv: '2021600009', name: 'Ngô Văn Hùng', class: 'CNTT01-K65', email: 'hungnv@student.edu.vn', phone: '0912345679', dob: '08/08/2003', gender: 'Nam', address: 'Hà Nội', gpa: 2.98, attendance: 82, absent: 7, status: 'active' },
            { id: 10, mssv: '2021600010', name: 'Đinh Thị Lan', class: 'CNTT03-K65', email: 'landt@student.edu.vn', phone: '0912345680', dob: '19/12/2003', gender: 'Nữ', address: 'Bắc Ninh', gpa: 3.45, attendance: 91, absent: 4, status: 'active' },
            { id: 11, mssv: '2021600011', name: 'Trịnh Văn Minh', class: 'CNTT02-K65', email: 'minhtv@student.edu.vn', phone: '0912345681', dob: '14/02/2003', gender: 'Nam', address: 'Hà Nội', gpa: 3.23, attendance: 86, absent: 6, status: 'active' },
            { id: 12, mssv: '2021600012', name: 'Lý Thị Nga', class: 'CNTT01-K65', email: 'galt@student.edu.vn', phone: '0912345682', dob: '27/10/2003', gender: 'Nữ', address: 'Vĩnh Phúc', gpa: 3.71, attendance: 94, absent: 2, status: 'active' }
        ];

        let filteredStudents = [...students];

        function renderTable() {
            const tbody = document.getElementById('studentTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const classFilter = document.getElementById('classFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredStudents = students.filter(student => {
                const matchSearch = student.name.toLowerCase().includes(searchTerm) ||
                                  student.mssv.includes(searchTerm) ||
                                  student.email.toLowerCase().includes(searchTerm);
                const matchClass = !classFilter || student.class === classFilter;
                const matchStatus = !statusFilter || student.status === statusFilter;
                return matchSearch && matchClass && matchStatus;
            });

            tbody.innerHTML = '';

            filteredStudents.forEach((student, index) => {
                const row = document.createElement('tr');
                row.onclick = () => showStudentDetail(student);

                const initials = student.name.split(' ').map(n => n[0]).join('').substring(0, 2);

                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><div class="student-avatar">${initials}</div></td>
                    <td><strong>${student.mssv}</strong></td>
                    <td>${student.name}</td>
                    <td>${student.class}</td>
                    <td>${student.email}</td>
                    <td>${student.phone}</td>
                    <td><strong>${student.gpa.toFixed(2)}</strong></td>
                    <td><strong>${student.attendance}%</strong></td>
                    <td>
                        <span class="status-badge ${student.status === 'active' ? 'status-active' : 'status-inactive'}">
                            ${student.status === 'active' ? 'Đang học' : 'Nghỉ học'}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateStats();
        }

        function updateStats() {
            const total = filteredStudents.length;
            const active = filteredStudents.filter(s => s.status === 'active').length;
            const avgAttendance = total > 0 ?
                Math.round(filteredStudents.reduce((sum, s) => sum + s.attendance, 0) / total) : 0;
            const classes = [...new Set(filteredStudents.map(s => s.class))].length;

            document.getElementById('totalStudents').textContent = total;
            document.getElementById('activeStudents').textContent = active;
            document.getElementById('avgAttendance').textContent = avgAttendance + '%';
            document.getElementById('classCount').textContent = classes;
        }

        function showStudentDetail(student) {
            const modal = document.getElementById('studentModal');
            const initials = student.name.split(' ').map(n => n[0]).join('').substring(0, 2);

            document.getElementById('modalAvatar').textContent = initials;
            document.getElementById('modalMSSV').textContent = student.mssv;
            document.getElementById('modalName').textContent = student.name;
            document.getElementById('modalClass').textContent = student.class;
            document.getElementById('modalDOB').textContent = student.dob;
            document.getElementById('modalGender').textContent = student.gender;
            document.getElementById('modalEmail').textContent = student.email;
            document.getElementById('modalPhone').textContent = student.phone;
            document.getElementById('modalAddress').textContent = student.address;
            document.getElementById('modalStatus').innerHTML = `
                <span class="status-badge ${student.status === 'active' ? 'status-active' : 'status-inactive'}">
                    ${student.status === 'active' ? 'Đang học' : 'Nghỉ học'}
                </span>
            `;
            document.getElementById('modalGPA').textContent = student.gpa.toFixed(2);
            document.getElementById('modalAttendance').textContent = student.attendance + '%';
            document.getElementById('modalAbsent').textContent = student.absent;

            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('studentModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('studentModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        function exportToExcel() {
            const data = filteredStudents.map((student, index) => ({
                'STT': index + 1,
                'MSSV': student.mssv,
                'Họ và tên': student.name,
                'Lớp': student.class,
                'Ngày sinh': student.dob,
                'Giới tính': student.gender,
                'Email': student.email,
                'Số điện thoại': student.phone,
                'Địa chỉ': student.address,
                'Điểm TB': student.gpa,
                'Tỷ lệ tham dự (%)': student.attendance,
                'Số buổi vắng': student.absent,
                'Trạng thái': student.status === 'active' ? 'Đang học' : 'Nghỉ học'
            }));

            const ws = XLSX.utils.json_to_sheet(data);

            // Tự động điều chỉnh độ rộng cột
            const colWidths = [
                { wch: 5 },  // STT
                { wch: 12 }, // MSSV
                { wch: 25 }, // Họ và tên
                { wch: 15 }, // Lớp
                { wch: 12 }, // Ngày sinh
                { wch: 10 }, // Giới tính
                { wch: 30 }, // Email
                { wch: 15 }, // SĐT
                { wch: 30 }, // Địa chỉ
                { wch: 10 }, // Điểm TB
                { wch: 18 }, // Tỷ lệ tham dự
                { wch: 15 }, // Số buổi vắng
                { wch: 12 }  // Trạng thái
            ];
            ws['!cols'] = colWidths;

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Danh sách sinh viên');

            const fileName = `Danh_sach_sinh_vien_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        let sortDirection = {};
        function sortTable(columnIndex) {
            const direction = sortDirection[columnIndex] || 'asc';

            filteredStudents.sort((a, b) => {
                let aVal, bVal;

                switch(columnIndex) {
                    case 2: aVal = a.mssv; bVal = b.mssv; break;
                    case 3: aVal = a.name; bVal = b.name; break;
                    case 4: aVal = a.class; bVal = b.class; break;
                    case 7: aVal = a.gpa; bVal = b.gpa; break;
                    case 8: aVal = a.attendance; bVal = b.attendance; break;
                    default:
                        // If column not sortable, keep order
                        return 0;
                }

                // Normalize undefined/null
                if (aVal === undefined || aVal === null) aVal = '';
                if (bVal === undefined || bVal === null) bVal = '';

                // Determine comparison
                let cmp = 0;
                const isNumber = typeof aVal === 'number' && typeof bVal === 'number';
                if (isNumber) {
                    cmp = aVal - bVal;
                } else {
                    // Compare as strings (case-insensitive)
                    const sa = String(aVal).toLowerCase();
                    const sb = String(bVal).toLowerCase();
                    cmp = sa.localeCompare(sb);
                }

                return direction === 'asc' ? cmp : -cmp;
            });

            // Toggle sort direction for next click
            sortDirection[columnIndex] = direction === 'asc' ? 'desc' : 'asc';

            renderTable();
        }

        // Wire up search/filter events
        document.getElementById('searchInput').addEventListener('input', renderTable);
        document.getElementById('classFilter').addEventListener('change', renderTable);
        document.getElementById('statusFilter').addEventListener('change', renderTable);

        // Initial render
        renderTable();
    </script>
</body>


